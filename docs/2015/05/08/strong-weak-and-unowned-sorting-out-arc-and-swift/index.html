<!DOCTYPE html>
<html lang="en">

<head>

    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6356224024630676"
        crossorigin="anonymous"></script>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6356224024630676",
            enable_page_level_ads: true,
            overlays: { bottom: true }
        });
    </script>

    <link rel="stylesheet" type="text/css"
        href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
    <script>
        window.addEventListener("load", function () {
            window.cookieconsent.initialise({
                "palette": {
                    "popup": {
                        "background": "#3e8bc5"
                    },
                    "button": {
                        "background": "#8ec760",
                        "text": "#ffffff"
                    }
                }
            })
        });
    </script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Strong, Weak, and Unowned – Sorting out ARC and Swift" />
<meta property="og:description" content="I&rsquo;m willing to bet that a good number of Swift developers struggle with the particulars of how strong, weak, and unowned affect the run-time behavior of their code. I, myself, wouldn&rsquo;t want to have to give an explanation of the finer points of Automatic Reference Counting (ARC) if my life depended on it.
I wanted to stop being unsure about the implications of typing one of those three words before variable / constant declarations, so I finally pulled up the Apple Documentation on ARC and began trying to digest the semantics." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.andrewcbancroft.com/2015/05/08/strong-weak-and-unowned-sorting-out-arc-and-swift/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2015-05-08T18:01:09+00:00" />
<meta property="article:modified_time" content="2015-05-08T18:01:09+00:00" />


<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Strong, Weak, and Unowned – Sorting out ARC and Swift"/>
<meta name="twitter:description" content="I&rsquo;m willing to bet that a good number of Swift developers struggle with the particulars of how strong, weak, and unowned affect the run-time behavior of their code. I, myself, wouldn&rsquo;t want to have to give an explanation of the finer points of Automatic Reference Counting (ARC) if my life depended on it.
I wanted to stop being unsure about the implications of typing one of those three words before variable / constant declarations, so I finally pulled up the Apple Documentation on ARC and began trying to digest the semantics."/>
<meta name="generator" content="Hugo 0.121.1">

    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Strong, Weak, and Unowned – Sorting out ARC and Swift",
  "url": "https:\/\/www.andrewcbancroft.com\/2015\/05\/08\/strong-weak-and-unowned-sorting-out-arc-and-swift\/",
  "wordCount": "2058",
  "datePublished": "2015-05-08T18:01:09Z",
  "dateModified": "2015-05-08T18:01:09Z",
  "author": {
    "@type": "Person",
    "name": "Andrew"
  },
  "keywords": "Swift, ARC, Strong, Unowned, Weak"

  ,"description": ""
}
</script>



    <title>Strong, Weak, and Unowned – Sorting out ARC and Swift</title>

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css"
        integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">

    
    <link href="https://www.andrewcbancroft.com/css/custom.css" rel="stylesheet">
    <link href="https://www.andrewcbancroft.com/css/syntax.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Muli:400,500,700" rel="stylesheet">

    
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
        integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

</head>

<body>
    <nav class="navbar navbar-expand-lg fixed-top px-5">
        <a class="navbar-brand" href="https://www.andrewcbancroft.com"><i class="fas fa-home"></i> Andrew Bancroft</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="nav navbar-nav mr-auto mt-2 mt-lg-0"></ul>
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="https://www.andrewcbancroft.com#pluralsight-courses">Pluralsight Courses</a>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Topics
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                        <h6 class="dropdown-header">iOS Development</h6>
                        <a class="dropdown-item" href="https://www.andrewcbancroft.com#data-persistence">Data Persistence</a>
                        <a class="dropdown-item" href="https://www.andrewcbancroft.com#dependency-management">Dependency
                            Management</a>
                        <a class="dropdown-item" href="https://www.andrewcbancroft.com#debugging">Debugging</a>
                        <a class="dropdown-item" href="https://www.andrewcbancroft.com#eventkit">Event Kit</a>
                        <a class="dropdown-item" href="https://www.andrewcbancroft.com#iap">In-App Purchases</a>
                        <a class="dropdown-item" href="https://www.andrewcbancroft.com#parse">Parse</a>
                        <a class="dropdown-item" href="https://www.andrewcbancroft.com#patterns-and-practices">Patterns and
                            Practices</a>
                        <a class="dropdown-item" href="https://www.andrewcbancroft.com#react-native">React Native</a>
                        <a class="dropdown-item" href="https://www.andrewcbancroft.com#swift-five">"Swift Five" Series</a>
                        <a class="dropdown-item" href="https://www.andrewcbancroft.com#swift-how-tos">Swift How-To's</a>
                        <a class="dropdown-item" href="https://www.andrewcbancroft.com#swift-language-notes">Swift Language
                            Notes</a>
                        
                        <a class="dropdown-item" href="https://www.andrewcbancroft.com#testing">Testing</a>
                        <a class="dropdown-item" href="https://www.andrewcbancroft.com#ui-work">User Interface Work</a>
                        <a class="dropdown-item" href="https://www.andrewcbancroft.com#xcode">Xcode</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="https://www.andrewcbancroft.com#dot-net-development">.Net Development</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="https://www.andrewcbancroft.com#musings">Musings</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Connect With Me
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="https://www.pluralsight.com/authors/andrew-bancroft"><i
                                class="fas fa-play"></i> Pluralsight Courses</a>
                        <a class="dropdown-item" href="https://github.com/andrewcbancroft"><i class="fab fa-github"></i>
                            GitHub</a>
                        <a class="dropdown-item" href="https://www.linkedin.com/in/andrewcbancroft/"><i
                                class="fab fa-linkedin"></i> LinkedIn</a>
                        <a class="dropdown-item" rel="me" href="https://hachyderm.io/@andrewcbancroft"><i
                                class="fab fa-mastodon"></i> Mastodon</a>
                        <a class="dropdown-item" href="https://twitter.com/andrewcbancroft"><i
                                class="fab fa-twitter"></i> Twitter</a>
                        <a class="dropdown-item" href="https://www.youtube.com/channel/UCDPV9kMhP-b5EFRI7d812pg"><i
                                class="fab fa-youtube"></i> YouTube</a>
                        <a class="dropdown-item" href="https://dataday.life"><i class="fas fa-link"></i>
                            www.dataday.life</a>
                        <a class="dropdown-item" href="https://www.andrewcbancroft.com/index.xml"><i class="fas fa-rss"></i> Feed</a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>

    
    
    
    

    
    
    

    
    <div class="container">
        <div class="row">
            <div class="col-sm-12">

                


<article>
  <div class="article">
    <header>
        <div class="alert alert-primary" role="alert">
            Learning about iOS development? <br/><br/>
            I am the author of <a href="https://bit.ly/iOS14-getting-started" class="alert-link">iOS 14 Getting Started</a>, <a href="https://bit.ly/building-ios-ui-swiftui" class="alert-link">Building iOS User Interfaces with SwiftUI</a>, and <a href="http://bit.ly/ps-author-page" class="alert-link">six other courses on Pluralsight</a>.  <br/><br/>Deepen your understanding by watching!
          </div>
      <h1 class="article-title">Strong, Weak, and Unowned – Sorting out ARC and Swift</h1>
    </header>
    <div class="content">

    <p></p>

    <p>I&rsquo;m willing to bet that a good number of Swift developers struggle with the particulars of how <code>strong</code>, <code>weak</code>, and <code>unowned</code> affect the run-time behavior of their code. I, myself, wouldn&rsquo;t want to have to give an explanation of the finer points of Automatic Reference Counting (ARC) if my life depended on it.</p>
<p>I wanted to stop being unsure about the implications of typing one of those three words before variable / constant declarations, so I finally pulled up the <a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/Swift_Programming_Language/AutomaticReferenceCounting.html">Apple Documentation on ARC</a> and began trying to digest the semantics. This article is an attempt to share what got sorted out in my brain as it regards ARC and Swift.</p>
<p>This article is long enough that I thought, &ldquo;Why don&rsquo;t I summarize my conclusions up front and then let folks read about how I got there if they so-desire”. So here you go: Conclusions first!</p>
<h3 id="conclusions">Conclusions</h3>
<ul>
<li>To determine if you even need to worry about <code>strong</code>, <code>weak</code>, or <code>unowned</code>, ask, &ldquo;Am I dealing with <em>reference</em> types”. If you&rsquo;re working with Structs or Enums, ARC isn&rsquo;t managing the memory for those Types and you don&rsquo;t even need to worry about specifying <code>weak</code> or <code>unowned</code> for those constants or variables.</li>
<li><code>Strong</code> references are fine in hierarchical relationships where the parent references the child, but not vice-versa. In fact, <code>strong</code> references are the most appropraite kind of reference most of the time.</li>
<li>When two instances are <em>optionally</em> related to one another, make sure that one of those instances holds a <code>weak</code> reference to the other.</li>
<li>When two instances are related in such a way that one of the instances can&rsquo;t exist without the other, the instance with the mandatory dependency needs to hold an <code>unowned</code> reference to the other instance.</li>
</ul>
<p>To see how I arrived at this set of conclusions, read on or jump around!</p>
<p><a name="arc-and-memory-management" class="jump-target"></a></p>
<h3 id="arc-and-memory-management">ARC and memory management</h3>
<p>For many, much of &ldquo;memory management” feels like a huge black box.</p>
<p>The mystical nature of memory management is exaggerated by the fact that many of the languages we&rsquo;re familiar with abstract it away. For the most part, we can simply write code and not think too hard about the number of bytes our object instances are using or how they get cleaned up when they&rsquo;re done being used. It just works.</p>
<p>Automatic Reference Counting (ARC) is one of those abstractions over managing memory. It&rsquo;s the methodology Apple employs to free up memory when class instances are finished using it.</p>
<p>ARC <em>only</em> applies to classes (so not structs or enums), because Automatic <em>Reference</em> Counting applies only to <em>reference Types</em>. Structs &amp; enums are <em>value</em> Types, so ARC does not manage the memory associated with instances of those Types.</p>
<p>The question that begins the discussion of our featured keywords is, &ldquo;How does ARC know when an instance is &ldquo;finished using” the memory it borrowed?”</p>
<p><a name="strong-references" class="jump-target"></a></p>
<h3 id="strong-references">Strong references</h3>
<p><code>Strong</code>, <code>weak</code>, and <code>unowned</code> are keywords that describe the nature of a reference in the ARC paradigm.</p>
<p>All references are <code>strong</code> references by default unless otherwise specified. <em>Most</em> of the time, this is the right thing to do. <code>Strong</code> is always implied when you declare a variable or constant. You don&rsquo;t need to type <code>strong</code> in Swift.</p>
<p>So what does the &ldquo;strength” of a reference have to do with how ARC manages memory?</p>
<p>ARC doesn&rsquo;t free up the memory being used by a class instance until <em>all</em> <code>strong</code> references to that instance are broken. How are <code>strong</code> references broken?</p>
<p><code>Strong</code> references can be broken…</p>
<ul>
<li>When a variable that references an instance of something is set to <code>nil</code></li>
<li>When a parent variable that holds a reference to a child class instance is to <code>nil</code> it will break the reference to the parent <em>and</em> the child</li>
<li>When a variable or constant goes out of scope – for example, if something gets initialized inside a control-flow code segment like an <code>if</code>/<code>else</code> or inside a <code>for</code> loop, when execution moves past that code segment, the reference is broken and the memory is freed by ARC</li>
</ul>
<p>Everything in ARC&rsquo;s memory management model hinges on the number of <code>strong</code> references are connected to an instance. The moment that the number of <code>strong</code> references counts down to zero, the memory where that instance was stored is freed.</p>
<p>So where does <code>weak</code> and <code>unowned</code> come in?</p>
<p><a name="weak-unowned-references" class="jump-target"></a></p>
<h3 id="weak-and-unowned-references">Weak and unowned references</h3>
<p><code>Weak</code> and <code>unowned</code> references come into the picture when we start talking about the relationships that emerge between class instances.</p>
<p><a name="relationships-between-instances" class="jump-target"></a></p>
<h4 id="relationships-between-instances">Relationships between instances</h4>
<p>Relationships between classes are core to the Object-Oriented paradigm. Whether you plan them or not, these relationships exist, and they affect the ARC memory management model.</p>
<p>So which kinds of relationships exist? Which ones warrant the use of <code>weak</code> and <code>unowned</code>?</p>
<p><a name="hierarchical" class="jump-target"></a></p>
<h5 id="hierarchical-relationships">Hierarchical relationships</h5>
<p>Much of our programming in Swift involves hierarchical relationships. Things are often modeled in such a way that one class instance holds <code>strong</code> references to one or more child class instances, and those child class instances hold one or more <code>strong</code> references to <em>other</em> child class instances, and so on. The <code>strong</code> reference relationship in this type of situation flows in one direction: from parent to child.</p>
<p>In this arrangement, <code>strong</code> references are normal and fine. But what happens if, say, a <em>child</em> class were to hold a reference back to its <em>parent</em>? This is where we can get into trouble with ARC.</p>
<p><a name="optional-mutually-dependent" class="jump-target"></a></p>
<h5 id="optional-mutually-dependent-relationships">Optional, mutually dependent relationships</h5>
<p>By the end of this section, my goal is to demonstrate the role of <code>weak</code> references.</p>
<p>When class instances depend on each other, that is, they both hold a reference to one another, it can be said that the instances are mutually dependent. Sometimes, the dependence isn&rsquo;t required – in these cases, it makes sense for one instance to exist without a reference to the other, and vice-versa.</p>
<p>If we were talking database cardinality, we might say that the relationship is 0:1 both ways.</p>
<p>An example is always nice to have before us – This past week, a tornado hit a zoo here in Oklahoma, and a few exotic animals escaped, so the theme is on my mind.</p>
<p>In a zoo, an <code>Animal</code> lives in an <code>Exhibit</code>. Sometimes <code>Exhibits</code> may be vacant. They could be cleaning it, or the <code>Animal</code> that lived there is sick or being moved, or a tornado hits it, etc.</p>
<p>Likewise, an <code>Animal</code> may not live in an <code>Exhibit</code>. It could be held in a temporary location while its <code>Exhibit</code> is being cleaned, or be in the process of being treated or transferred to another location, or it could have escaped the zoo due to a tornado, etc.</p>
<p>We could model this example as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">class</span> <span class="nc">Animal</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="kd">let</span> <span class="nv">name</span><span class="p">:</span> <span class="nb">String</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="kd">let</span> <span class="nv">species</span><span class="p">:</span> <span class="nb">String</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="kd">init</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">species</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="kc">self</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="kc">self</span><span class="p">.</span><span class="n">species</span> <span class="p">=</span> <span class="n">species</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="kd">var</span> <span class="nv">exhibit</span><span class="p">:</span> <span class="n">Exhibit</span><span class="p">?</span>  <span class="c1">// notice the optional nature of exhibit</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"> 
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="kd">class</span> <span class="nc">Exhibit</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="kd">let</span> <span class="nv">title</span><span class="p">:</span> <span class="nb">String</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="kd">init</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span> <span class="kc">self</span><span class="p">.</span><span class="n">title</span> <span class="p">=</span> <span class="n">title</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="kd">var</span> <span class="nv">animal</span><span class="p">:</span> <span class="n">Animal</span><span class="p">?</span> <span class="c1">// notice the optional nature of animal</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Let&rsquo;s consider the situation where an <code>Animal</code> <em>is</em> living in an <code>Exhibit</code>. It might be nice to traverse a relationship between them to get information about one or the other. So as we instantiate an <code>Animal</code> and an <code>Exhibit</code>, the next immediate step would be to assign the instances to each other&rsquo;s corresponding property.</p>
<p>Now consider the situation that happened this week – a tornado hits the zoo and the <code>Animal</code> escapes from its <code>Exhibit</code>. Say that <em>unlike</em> this week, the <code>Animal</code> isn&rsquo;t recovered (they actually got the animals that escaped back). Suppose that it roams the plains of Oklahoma in freedom. The zoo, in turn, has to close the <code>Exhibit</code>. To model this, we may simply set the <code>Animal</code> instance to nil and the <code>Exhibit</code> instance to nil.</p>
<p><a name="memory-leak-warning" class="jump-target"></a></p>
<h6 id="memory-leak-warning">Memory leak warning</h6>
<p>The example just given is one that shows how it is possible to create a memory leak in your application. How?</p>
<p>It all has to do with ARC – remember that it <em>only</em> frees up memory for a class instance when there are <em>zero</em> references to it.</p>
<p>In our <code>Animal</code> – <code>Exhibit</code> example, both instances referenced <em>each other</em>. When we set the <code>Animal</code> instance to nil, the <code>Exhibit</code> instance still held a reference to it through its <code>animal</code> property.</p>
<p>In turn, since that <code>Animal</code> instance is still around, it holds a reference to the <code>Exhibit</code> instance through its <code>exhibit</code> property. So when we set the <code>Exhibit</code> instance to nil, the <code>Animal</code> still holds on to it.</p>
<p><em>Now</em> we have a dilemma. While the <code>Animal</code> and the <code>Exhibit</code> continue to reference each other (so neither instance&rsquo;s memory can be freed), <em>nothing else does</em> – there&rsquo;s no way to access either instance any more. Thus, a memory leak is created.</p>
<p>But there&rsquo;s hope! In this &ldquo;Optional, mutually dependent relationship” scenario, this is where the keyword <code>weak</code> comes into play.</p>
<p><a name="breaking-strong-reference-cycle" class="jump-target"></a></p>
<h6 id="breaking-strong-reference-cycle">Breaking strong reference cycle</h6>
<p>The situation just described is what&rsquo;s known as a &ldquo;strong reference cycle”.</p>
<p>Thankfully, there&rsquo;s a way to break those cycles and avoid memory leaks.</p>
<p>In the situation where that optional mutually dependent relationship exists, such as between an <code>Animal</code> and an <code>Exhibit</code>, changing one of those instances reference to the other from <code>strong</code> to <code>weak</code> will break the cycle.</p>
<p>It doesn&rsquo;t really matter which class holds the weak reference, just as long as one of them does.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">class</span> <span class="nc">Animal</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="kd">let</span> <span class="nv">name</span><span class="p">:</span> <span class="nb">String</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="kd">let</span> <span class="nv">species</span><span class="p">:</span> <span class="nb">String</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="kd">init</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">species</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="kc">self</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="kc">self</span><span class="p">.</span><span class="n">species</span> <span class="p">=</span> <span class="n">species</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="kd">var</span> <span class="nv">exhibit</span><span class="p">:</span> <span class="n">Exhibit</span><span class="p">?</span>  <span class="c1">// we&#39;ll hold a strong reference to the exhibit</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"> 
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="kd">class</span> <span class="nc">Exhibit</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="kd">let</span> <span class="nv">title</span><span class="p">:</span> <span class="nb">String</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="kd">init</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span> <span class="kc">self</span><span class="p">.</span><span class="n">title</span> <span class="p">=</span> <span class="n">title</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="kr">weak</span> <span class="kd">var</span> <span class="nv">animal</span><span class="p">:</span> <span class="n">Animal</span><span class="p">?</span> <span class="c1">// but notice - we&#39;re holding a _weak_ reference to the animal</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Making the <code>Exhibit's</code> <code>animal</code> property hold a <code>weak</code> reference to an <code>Animal</code> instance eliminates the possibility of a strong reference cycle.</p>
<p>So what about <code>unowned</code>?</p>
<p><a name="mandatory-one-way-dependent" class="jump-target"></a></p>
<h5 id="mandatory-one-way-dependent-relationships">Mandatory, one-way dependent relationships</h5>
<p>By the end of this section, my goal is to demonstrate the role of <code>unowned</code> references.</p>
<p>There is one final category of relationship that pertains most immediately to the topic of ARC. There are times when two class instances are related to one another, but <em>one</em> of those instance <em>cannot</em> exist without the other.</p>
<p>Let&rsquo;s continue with the zoo theme. Suppose that our zoo issues <code>AnnualPasses</code> to <code>Visitors</code>. A <code>Visitor</code> can come to the zoo <em>without</em> an <code>AnnualPass</code>, of course, and can thus exist on its own and happily enjoy the exhibits. An <code>AnnualPass</code>, however, is <em>always</em> issued to a <code>Visitor</code> and cannot exist without being associated with one.</p>
<p>To model this kind of relationship, we may define some classes as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">class</span> <span class="nc">Visitor</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="kd">let</span> <span class="nv">name</span><span class="p">:</span> <span class="nb">String</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="kd">var</span> <span class="nv">annualPass</span><span class="p">:</span> <span class="n">AnnualPass</span><span class="p">?</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="kd">init</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="kc">self</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="kd">class</span> <span class="nc">AnnualPass</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="kd">let</span> <span class="nv">number</span><span class="p">:</span> <span class="nb">UInt64</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="kr">unowned</span> <span class="kd">let</span> <span class="nv">passholder</span><span class="p">:</span> <span class="n">Visitor</span> <span class="c1">// notice the use of an _unowned_ reference</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="kd">init</span><span class="p">(</span><span class="n">number</span><span class="p">:</span> <span class="nb">UInt64</span><span class="p">,</span> <span class="n">passholder</span><span class="p">:</span> <span class="n">Visitor</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="kc">self</span><span class="p">.</span><span class="n">number</span> <span class="p">=</span> <span class="n">number</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="kc">self</span><span class="p">.</span><span class="n">passholder</span> <span class="p">=</span> <span class="n">passholder</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Notice a couple of things:</p>
<ol>
<li>The <code>Visitor</code> holds an optional <code>strong</code> reference to an <code>AnnualPass</code> instance</li>
<li>The <code>AnnualPass</code> holds a <em>non</em>-optional <code>unowned</code> reference to a <code>Visitor</code> instance</li>
</ol>
<p>Modeling things this way also eliminates the possibility of a strong reference cycle by allowing the <code>strong</code> reference count to reach zero when a <code>Visitor</code> variable is set to nil.</p>
<p><a name="conclusions-2" class="jump-target"></a></p>
<h3 id="conclusions-1">Conclusions</h3>
<p>I know I stated these at the beginning, but I&rsquo;ll restate them here just for completeness…</p>
<ul>
<li>To determine if you even need to worry about <code>strong</code>, <code>weak</code>, or <code>unowned</code>, ask, &ldquo;Am I dealing with <em>reference</em> types”. If you&rsquo;re working with Structs or Enums, ARC isn&rsquo;t managing the memory for those Types and you don&rsquo;t even need to worry about specifying <code>weak</code> or <code>unowned</code> for those constants or variables.</li>
<li><code>Strong</code> references are fine in hierarchical relationships where the parent references the child, but not vice-versa. In fact, <code>strong</code> references are the most appropraite kind of reference most of the time.</li>
<li>When two instances are <em>optionally</em> related to one another, make sure that one of those instances holds a <code>weak</code> reference to the other.</li>
<li>When two instances are related in such a way that one of the instances can&rsquo;t exist without the other, the instance with the mandatory dependency needs to hold an <code>unowned</code> reference to the other instance.</li>
</ul>
<p><a name="share" class="jump-target"></a></p>

    <aside>
      
      
      <div class="resources">
        <div class="resources-header">
            You might also enjoy...
        </div>
        
        <ul class="resources-content">
            
            <li><i class="fa fa-angle-right"></i> <a href="https://www.andrewcbancroft.com/2015/04/24/clarifying-swift-access-control-hint-swift-isnt-c-sharp/">Clarifying Swift Access Control (Hint:  Swift Isn’t C#)</a></li>
            
            <li><i class="fa fa-angle-right"></i> <a href="https://www.andrewcbancroft.com/2015/04/22/3-nuances-of-swift-extensions/">3 Nuances of Swift Extensions</a></li>
            
            <li><i class="fa fa-angle-right"></i> <a href="https://www.andrewcbancroft.com/2015/04/15/testability-tip-for-swift-developers-public-over-private/">Testability Tip for Swift Developers – Public Over Private</a></li>
            
            <li><i class="fa fa-angle-right"></i> <a href="https://www.andrewcbancroft.com/2015/04/08/how-delegation-works-a-swift-developer-guide/">How Delegation Works – A Swift Developer’s Guide</a></li>
            
            <li><i class="fa fa-angle-right"></i> <a href="https://www.andrewcbancroft.com/2015/04/01/enums-instead-of-booleans-an-example-implementation/">Enums Instead of Booleans – An Example Implementation</a></li>
            
        <ul>
      
    </aside>

    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "andrewcbancroft" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </article>



            </div>

        </div>
    </div>

    

    <footer class="footer text-center">
        <div class="container">
            <span class="text-muted">This project contains 184 pages and is available on <a
                    href="https://github.com/andrewcbancroft/andrewcbancroft-blog/tree/master/content/blog">GitHub</a>.
                Copyright &copy; Andrew Bancroft, <time datetime="2023">2023</time>.</span>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"
        integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"
        integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
        crossorigin="anonymous"></script>
    <script>
        function createCopyButton(highlightDiv) {
            const button = document.createElement("button");
            button.className = "copy-code-button";
            button.type = "button";
            button.innerText = "Copy";
            button.addEventListener("click", () =>
                copyCodeToClipboard(button, highlightDiv)
            );
            addCopyButtonToDom(button, highlightDiv);
        }

        async function copyCodeToClipboard(button, highlightDiv) {
            const codeToCopy = highlightDiv.querySelector(":last-child > .chroma > code")
                .innerText;
            try {
                result = await navigator.permissions.query({ name: "clipboard-write" });
                if (result.state == "granted" || result.state == "prompt") {
                    await navigator.clipboard.writeText(codeToCopy);
                } else {
                    copyCodeBlockExecCommand(codeToCopy, highlightDiv);
                }
            } catch (_) {
                copyCodeBlockExecCommand(codeToCopy, highlightDiv);
            } finally {
                codeWasCopied(button);
            }
        }

        function copyCodeBlockExecCommand(codeToCopy, highlightDiv) {
            const textArea = document.createElement("textArea");
            textArea.contentEditable = "true";
            textArea.readOnly = "false";
            textArea.className = "copyable-text-area";
            textArea.value = codeToCopy;
            highlightDiv.insertBefore(textArea, highlightDiv.firstChild);
            const range = document.createRange();
            range.selectNodeContents(textArea);
            const sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(range);
            textArea.setSelectionRange(0, 999999);
            document.execCommand("copy");
            highlightDiv.removeChild(textArea);
        }

        function codeWasCopied(button) {
            button.blur();
            button.innerText = "Copied!";
            setTimeout(function () {
                button.innerText = "Copy";
            }, 2000);
        }

        function addCopyButtonToDom(button, highlightDiv) {
            highlightDiv.insertBefore(button, highlightDiv.firstChild);
            const wrapper = document.createElement("div");
            wrapper.className = "highlight-wrapper";
            highlightDiv.parentNode.insertBefore(wrapper, highlightDiv);
            wrapper.appendChild(highlightDiv);
        }

        document
            .querySelectorAll(".highlight")
            .forEach((highlightDiv) => createCopyButton(highlightDiv));

    </script>
</body>

</html>