<!DOCTYPE html>
<html lang="en">

<head>

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-111087893-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-111087893-1');
    </script>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6356224024630676",
            enable_page_level_ads: true
        });
    </script>

    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Why Do We Need to Annotate Escaping Closures in Swift?" />
<meta property="og:description" content="My last entry on escaping closures ended up having way more interaction than I anticipated! It goes to show that you never know what the impact of a piece of writing will have. But that's a different story&#8230; :]
Several readers commented here and on Medium with the question, &#8220;Why? Why do we need to mark escaping closures with @escaping?&#8221;
Jump to&#8230;   Do it yourself, compiler!   Insight from the Swift gurus   I see what you did there&#8230; Let me help you out&#8230;   How helpful is it, really?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.andrewcbancroft.com/2017/05/11/why-do-we-need-to-annotate-escaping-closures-in-swift/" />
<meta property="article:published_time" content="2017-05-11T17:58:46&#43;00:00"/>
<meta property="article:modified_time" content="2017-05-11T17:58:46&#43;00:00"/>

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Why Do We Need to Annotate Escaping Closures in Swift?"/>
<meta name="twitter:description" content="My last entry on escaping closures ended up having way more interaction than I anticipated! It goes to show that you never know what the impact of a piece of writing will have. But that's a different story&#8230; :]
Several readers commented here and on Medium with the question, &#8220;Why? Why do we need to mark escaping closures with @escaping?&#8221;
Jump to&#8230;   Do it yourself, compiler!   Insight from the Swift gurus   I see what you did there&#8230; Let me help you out&#8230;   How helpful is it, really?"/>
<meta name="generator" content="Hugo 0.55.4" /> 
    
    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Why Do We Need to Annotate Escaping Closures in Swift?",
  "url": "https:\/\/www.andrewcbancroft.com\/2017\/05\/11\/why-do-we-need-to-annotate-escaping-closures-in-swift\/",
  "wordCount": "1018",
  "datePublished": "2017-05-11T17:58:46\x2b00:00",
  "dateModified": "2017-05-11T17:58:46\x2b00:00",
  "author": {
    "@type": "Person",
    "name": "Andrew"
  },
  "keywords": "Swift, Closures"
}
</script>



    <title>Why Do We Need to Annotate Escaping Closures in Swift?</title>

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
        crossorigin="anonymous">

    
    <link href="https://www.andrewcbancroft.com/css/custom.css" rel="stylesheet"> 
    <link href="https://www.andrewcbancroft.com/css/syntax.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Muli:400,500,700" rel="stylesheet">
        
    <link href="" rel="alternate" type="application/rss+xml" title="Andrew Bancroft" /> 
    
    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

</head>

<body>

    <nav class="navbar navbar-expand-sm fixed-top">
        <div class="container">
            <a class="navbar-brand" href="https://www.andrewcbancroft.com">Andrew Bancroft</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="nav navbar-nav mr-auto"></ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">
                            Notes
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="https://www.andrewcbancroft.com#sql-server-notes">SQL Server</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true"
                                aria-expanded="false">
                                Blog Articles
                            </a>
                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                                <a class="dropdown-item" href="https://www.andrewcbancroft.com#azure">Azure</a>
                                <a class="dropdown-item" href="https://www.andrewcbancroft.com#dimensional-modeling">Dimensional Modeling</a>
                                <a class="dropdown-item" href="https://www.andrewcbancroft.com#general-data-concepts">General Data Concepts</a>
                                <a class="dropdown-item" href="https://www.andrewcbancroft.com#machine-learning">Machine Learning</a>
                                <a class="dropdown-item" href="https://www.andrewcbancroft.com#r">R</a>
                                <a class="dropdown-item" href="https://www.andrewcbancroft.com#sql-server">SQL Server</a>
                                <a class="dropdown-item" href="https://www.andrewcbancroft.com#statistics">Statistics</a>
                            </div>
                        </li>
                    
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">
                            About
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="https://www.andrewcbancroft.comabout/andrew_bancroft/">About Andrew</a>
                            <a class="dropdown-item" href="https://github.com/andrewcbancroft">GitHub</a>
                            <a class="dropdown-item" href="https://www.linkedin.com/in/andrewcbancroft/">LinkedIn</a>
                            <a class="dropdown-item" href="https://twitter.com/andrewcbancroft">Twitter</a>
                            <a class="dropdown-item" href="https://www.youtube.com/channel/UCDPV9kMhP-b5EFRI7d812pg">YouTube</a>
                            <a class="dropdown-item" href="https://www.pluralsight.com/authors/andrew-bancroft">Pluralsight Courses</a>
                            <a class="dropdown-item" href="https://www.andrewcbancroft.com">www.andrewcbancroft.com</a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    
    <div class="container">
        <div class="row">
            <div class="col-sm-12">

                


<article>
  <div class="article">
    <header>
      <h1 class="article-title">Why Do We Need to Annotate Escaping Closures in Swift?</h1>
    </header>
    <div class="content">

    

<p>My last entry on <a href="https://www.andrewcbancroft.com/2017/04/26/what-in-the-world-is-an-escaping-closure-in-swift/">escaping closures</a> ended up having way more interaction than I anticipated! It goes to show that you never know what the impact of a piece of writing will have. But that's a different story&#8230; :]</p>

<p>Several readers commented here and on Medium with the question, &#8220;Why? Why do we need to mark escaping closures with <code>@escaping</code>?&#8221;</p>

<div class="resources">
  <div class="resources-header">
    Jump to&#8230;
  </div>
  

<p><ul class="resources-content">
    <li>
      <a href="#do-it-self">Do it yourself, compiler!</a>
    </li>
    <li>
      <a href="#insight">Insight from the Swift gurus</a>
    </li>
    <li>
      <a href="#help">I see what you did there&#8230; Let me help you out&#8230;</a>
    </li>
    <li>
      <a href="#how-helpful">How helpful is it, really?</a>
    </li>
    <li>
      <a href="#resilience">Writing resilient code</a>
    </li>
    <li>
      <a href="#bottom-line">The bottom line &#8211; The compiler is making you think</a>
    </li>
    <li>
      <a href="#related">You might also enjoy&#8230;</a>
    </li>
    <li>
      <a href="#share">Was this article helpful? Please share!</a>
    </li>
  </ul>
</div></p>

<p><a name="do-it-self" class="jump-target"></a></p>

<h1 id="do-it-yourself-compiler">Do it yourself, compiler!</h1>

<p>Observant minds looked at the compiler's ability to say, &#8220;Hey! This closure can escape &#8211; Annotate it with <code>@escaping</code>!&#8221; and asked, &#8220;Well&#8230; <em>why</em>?? If you, compiler, are smart enough to figure out that I need to annotate it, why can't you just deal with it automatically and let me go about my business?&#8221;</p>

<p>Good. Question.</p>

<p>And one that I didn't know the answer to. So I researched!</p>

<p><a name="insight" class="jump-target"></a></p>

<h1 id="insight-from-the-swift-gurus">Insight from the Swift gurus</h1>

<p>As I dug around in the <a href="https://github.com/apple/swift">Swift GitHub repository</a> and the <a href="https://lists.swift.org/mailman/listinfo">Swift Evolution list</a> I found <a href="https://lists.swift.org/pipermail/swift-evolution/Week-of-Mon-20160530/019880.html">a quote from Chris Lattner</a> that stuck out:</p>

<blockquote>
<p>The compiler has enough logic in it to provide a great QoI (Quality of Implementation) experience when a developer doesn’t think about escaping, and tries to escape a closure &#8211; it can provide a fixit that suggests adding @escaping.&#8221;</p>
</blockquote>

<p>Did you catch that?</p>

<p>When the Swift compiler requires us to annotate our APIs with <code>@escaping</code>, that's its way of doing &#8220;quality of implementation&#8221;.</p>

<p>Essentially, it's a red flag saying, &#8220;You really ought to think about this whole escaping thing that you just introduced (whether you knew you were doing it or not)&#8230; it has significant impact on your implementation <em>and</em> on the caller of your function!&#8221;</p>

<p><a name="help" class="jump-target"></a></p>

<h1 id="i-see-what-you-did-there-8230-let-me-help-you-out-8230">I see what you did there&#8230; Let me help you out&#8230;</h1>

<p>The Swift compiler, for better or worse, wants to be very&#8230; &#8220;helpful&#8221;&#8230;</p>

<p>Some people hate it. I love it.</p>

<p>I <em>want</em> to be told, &#8220;Hey, Andrew&#8230; you're about to break stuff &#8211; don't do that.&#8221;</p>

<p>I'd rather head off issues during development than at run-time.</p>

<p><a name="how-helpful" class="jump-target"></a></p>

<h1 id="how-helpful-is-it-really">How helpful is it, really?</h1>

<p>But really&#8230; How helpful is this particular compiler error? What value does this fix-it option provide?</p>

<p>Try this: Think about what would happen if the compiler <em>didn't</em> tell you about the possibility of your function's closure escaping.</p>

<p>I was working the other day, cruising along writing what I thought was perfectly normal code when I hit this &#8220;annotate your function's closure parameter with <code>@escaping</code>&#8221; error, myself.</p>

<p>&#8220;<code>@escaping</code>, Huh? What's that?!&#8221;</p>

<p>1 &#8211; I wasn't thinking about escaping closures because<br />
2 &#8211; I had no idea that I <em>could</em> think about escaping closures!!</p>

<p>It turns out that this could have been really bad, agreed? Asynchronous behavior in software requires a little more thought than your normal top-down procedural approach.</p>

<p>If the compiler hadn't stopped me, I could have inadvertently imposed the need to think in terms of dispatch queues or asynchronous callbacks on the users of my API.</p>

<p>Is this only something that &#8220;newbies&#8221; need to have the compiler's help with though?</p>

<p>One could argue that I probably should have been aware of this particular feature of Swift &#8212; had I been a better developer, maybe I wouldn't need the compiler to hold my hand so much.</p>

<p>Okay &#8211; Fair point. That leads me to one last gleaning from Lattner's Swift Evolution entry that I'll comment on before wrapping up.</p>

<p><a name="resilience" class="jump-target"></a></p>

<h1 id="writing-resilient-code">Writing resilient code</h1>

<p>Let me reflect really quickly on one more quote from the <a href="https://lists.swift.org/pipermail/swift-evolution/Week-of-Mon-20160530/019880.html">Swift Evolution entry</a> before I end for today.</p>

<blockquote>
<p>John McCall pointed out that resilience in the type system is different than resilience in practice: <strong>An API changing to capture a closure and use it long after it was originally passed</strong> is <strong>likely to break the clients</strong> regardless of whether the type system captures this as an issue. He argues (and the argument is strong IMO) it is <em>better</em> for resilient APIs to default to @noescape, <strong>since that forces the author of V2 to think about whether they are breaking their clients</strong>. <small>(emphasis mine)</small></p>
</blockquote>

<p>Resilience is all about how clients are affected when you <em>change</em> the API or its implementation.</p>

<p>Suppose that a team mate of mine writes a function&#8230; <a href="https://www.andrewcbancroft.com/2017/04/25/every-developer-api-designer/">She's just created an API</a>, true?</p>

<p>Suppose that the function asks for a closure, but for now it's just a regular old closure. No escaping or anything.</p>

<p>Others on my team are going to start coding against that function's signature. If the function is honest, it allows me and my team to have expectations about what it'll do when it executes.</p>

<p>Now suppose that I'm going to work on version 2 of that same API. Only <em>now</em>, I'm going to introduce the opportunity for that closure to <a href="https://www.andrewcbancroft.com/2017/04/26/what-in-the-world-is-an-escaping-closure-in-swift/">escape</a> (maybe intentionally, or maybe accidentally out of ignorance).</p>

<p>Thaaaat's gonna break my team. For sure.</p>

<p>They're using the API as it is expecting normal synchronous behavior from the function. Now <em>I've</em> gone in and fundamentally changed what their expectations should be.</p>

<p>In other words, I haven't been very resilient.</p>

<p>The default behavior of closures passed to functions is to be <code>@noescape</code>. If I introduce the possibility for that closure to escape, I need to be red-flag warned about that, because I need to come up with some way to communicate this breaking change to the clients of the API. And/or provide an alternative so that clients of API v1 can still use it as expected.</p>

<p>Most of all, I need to <strong>think</strong> about the implications of what I'm doing, and sometimes (a lot of the times) that takes prompting.</p>

<p><a name="bottom-line" class="jump-target"></a></p>

<h1 id="the-bottom-line-8211-the-compiler-is-making-you-think">The bottom line &#8211; The compiler is making you think</h1>

<p>All of this to say: The compiler is making you think. Not only that, it's forcing you to conform.</p>

<p>From what I've found, that's the idea behind &#8220;why&#8221; we need to mark escaping closures with <code>@escaping</code> in Swift.</p>

<p><a name="related" class="jump-target"></a></p>

<div class="resources">
  <div class="resources-header">
    You might also enjoy&#8230;
  </div>
  

<p><ul class="resources-content">
    <li>
      <i class="fa fa-angle-right"></i> <a href="https://www.andrewcbancroft.com/2017/04/26/what-in-the-world-is-an-escaping-closure-in-swift/" title="What in the World is an “Escaping Closure” in Swift?"</a>What in the World is an “Escaping Closure” in Swift?
    </li>
  </ul>
</div></p>

<p><a name="share" class="jump-target"></a></p>


    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "andrewcbancroft" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </article>



            </div>

        </div>
    </div>

    

    <footer class="footer text-center">
        <div class="container">
            <span class="text-muted">This project contains 146 pages and is available on <a href="https://github.com/andrewcbancroft/datadaylife-blog">GitHub</a>. Copyright &copy; Andrew Bancroft, <time datetime="2019">2019</time>.</span>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
        crossorigin="anonymous"></script>

</body>

</html>