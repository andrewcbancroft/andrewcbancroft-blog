<!DOCTYPE html>
<html lang="en">

<head>

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-111087893-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-111087893-1');
    </script>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6356224024630676",
            enable_page_level_ads: true
        });
    </script>

    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="How to Create Mocks and Stubs in Swift" />
<meta property="og:description" content="Without 100% support for a mocking framework like OCMock, I found myself needing to get creative when building&nbsp;mock objects and method stubs in Swift unit tests. &nbsp;The great thing about testing is that you're&#8230;well&#8230;&nbsp;testing things out to see if they'll work, and I found a solution that I'm pretty happy&nbsp;with for now. &nbsp;I'm open to better ways, so leave a comment if you've had good results using a different design!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.andrewcbancroft.com/2014/07/15/how-to-create-mocks-and-stubs-in-swift/" />
<meta property="article:published_time" content="2014-07-15T05:12:16&#43;00:00"/>
<meta property="article:modified_time" content="2014-07-15T05:12:16&#43;00:00"/>

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How to Create Mocks and Stubs in Swift"/>
<meta name="twitter:description" content="Without 100% support for a mocking framework like OCMock, I found myself needing to get creative when building&nbsp;mock objects and method stubs in Swift unit tests. &nbsp;The great thing about testing is that you're&#8230;well&#8230;&nbsp;testing things out to see if they'll work, and I found a solution that I'm pretty happy&nbsp;with for now. &nbsp;I'm open to better ways, so leave a comment if you've had good results using a different design!"/>
<meta name="generator" content="Hugo 0.55.4" /> 
    
    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "How to Create Mocks and Stubs in Swift",
  "url": "https:\/\/www.andrewcbancroft.com\/2014\/07\/15\/how-to-create-mocks-and-stubs-in-swift\/",
  "wordCount": "1328",
  "datePublished": "2014-07-15T05:12:16\x2b00:00",
  "dateModified": "2014-07-15T05:12:16\x2b00:00",
  "author": {
    "@type": "Person",
    "name": "Andrew"
  },
  "keywords": "iOS \/ Mac, Swift, Mock, Stub, Unit Test"
}
</script>



    <title>How to Create Mocks and Stubs in Swift</title>

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
        crossorigin="anonymous">

    
    <link href="https://www.andrewcbancroft.com/css/custom.css" rel="stylesheet"> 
    <link href="https://www.andrewcbancroft.com/css/syntax.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Muli:400,500,700" rel="stylesheet">
        
    <link href="" rel="alternate" type="application/rss+xml" title="Andrew Bancroft" /> 
    
    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

</head>

<body>

    <nav class="navbar navbar-expand-sm fixed-top">
        <div class="container">
            <a class="navbar-brand" href="https://www.andrewcbancroft.com">Andrew Bancroft</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="nav navbar-nav mr-auto"></ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">
                            Notes
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="https://www.andrewcbancroft.com#sql-server-notes">SQL Server</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true"
                                aria-expanded="false">
                                Blog Articles
                            </a>
                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                                <a class="dropdown-item" href="https://www.andrewcbancroft.com#azure">Azure</a>
                                <a class="dropdown-item" href="https://www.andrewcbancroft.com#dimensional-modeling">Dimensional Modeling</a>
                                <a class="dropdown-item" href="https://www.andrewcbancroft.com#general-data-concepts">General Data Concepts</a>
                                <a class="dropdown-item" href="https://www.andrewcbancroft.com#machine-learning">Machine Learning</a>
                                <a class="dropdown-item" href="https://www.andrewcbancroft.com#r">R</a>
                                <a class="dropdown-item" href="https://www.andrewcbancroft.com#sql-server">SQL Server</a>
                                <a class="dropdown-item" href="https://www.andrewcbancroft.com#statistics">Statistics</a>
                            </div>
                        </li>
                    
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">
                            About
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="https://www.andrewcbancroft.comabout/andrew_bancroft/">About Andrew</a>
                            <a class="dropdown-item" href="https://github.com/andrewcbancroft">GitHub</a>
                            <a class="dropdown-item" href="https://www.linkedin.com/in/andrewcbancroft/">LinkedIn</a>
                            <a class="dropdown-item" href="https://twitter.com/andrewcbancroft">Twitter</a>
                            <a class="dropdown-item" href="https://www.youtube.com/channel/UCDPV9kMhP-b5EFRI7d812pg">YouTube</a>
                            <a class="dropdown-item" href="https://www.pluralsight.com/authors/andrew-bancroft">Pluralsight Courses</a>
                            <a class="dropdown-item" href="https://www.andrewcbancroft.com">www.andrewcbancroft.com</a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    
    <div class="container">
        <div class="row">
            <div class="col-sm-12">

                


<article>
  <div class="article">
    <header>
      <h1 class="article-title">How to Create Mocks and Stubs in Swift</h1>
    </header>
    <div class="content">

    

<p>Without 100% support for a mocking framework like <a title="OCMock" href="http://ocmock.org/" target="_blank">OCMock</a>, I found myself needing to get creative when building&nbsp;mock objects and method stubs in Swift unit tests. &nbsp;The great thing about testing is that you're&#8230;well&#8230;&nbsp;<em>testing things out</em> to see if they'll work, and I found a solution that I'm pretty happy&nbsp;with for now. &nbsp;I'm open to better ways, so leave a comment if you've had good results using a different design!</p>

<p>The process&nbsp;is essentially this (example to follow):</p>

<ol>
<li>Ensure that the&nbsp;class that you would like to test is designed so that you can substitute your mock for the real one that's used in your class' implementation</li>
<li>Create an <span class="lang:swift decode:true  crayon-inline ">XCTestCase</span>&nbsp;&nbsp;class with a test function in your unit test project</li>
<li>Within the function body create&nbsp;a <em>nested</em> class</li>
<li>Make the nested class inherit from the real object you're trying to mock / create a method stub for</li>
<li>You can give the nested class a name such as Mock[ObjectName]</li>
<li>Configure the mock object however you need by setting its properties or overriding its function implementations with stubbed implementations – no need to override every function&#8230; only the one(s) that your class calls during the test at hand</li>
<li>Instantiate the class you're testing and pass in an instance of the&nbsp;mock object you just nested in the test function to your&nbsp;class somehow (either through its initializer, by setting a property on the class, or by passing it into the method under test via parameter &#8212; however you intended to &#8216;inject' the mock from step 1 is what you should do)</li>
<li>XCTAssert&#8230;</li>
</ol>

<p>Let's see those 8 steps in action for those of us who are more visually inclined.</p>

<p>EDIT: &nbsp;July 22, 2014 – I've added a simple XCode Project to GitHub for those interested in seeing the setup directly in XCode at &nbsp;<a title="GitHub - MocksAndStubs" href="https://github.com/andrewcbancroft/MocksAndStubs" target="_blank"><a href="https://github.com/andrewcbancroft/MocksAndStubs">https://github.com/andrewcbancroft/MocksAndStubs</a></a></p>

<p>The scenario that I'd like to use a mock class in is this: &nbsp;I have a CoreData application and I'd like to be able to mock the <span class="lang:swift decode:true  crayon-inline ">NSManagedObjectContext</span>&nbsp;&nbsp;so that instead of making actual database fetch requests, I can just provide stubs of various sorts with the kinds of responses I'd expect from the real database calls to ensure my class will do the right thing based on predictable results. &nbsp;To do this I begin at step 1&#8230;</p>

<h4 id="1-nbsp-ensure-that-the-nbsp-class-that-you-would-like-to-test-is-designed-so-that-you-can-substitute-your-mock-for-the-real-one-that-8217-s-used-in-your-class-8217-implementation">1. &nbsp;Ensure that the&nbsp;class that you would like to test is designed so that you can substitute your mock for the real one that's used in your class' implementation</h4>

<p>In the&nbsp;example class below, I&nbsp;intend to provide the <span class="lang:swift decode:true  crayon-inline ">NSManagedObjectContext</span>&nbsp;&nbsp;dependency through&nbsp;the class' initializer which will set a property that is used by my class' methods later on, but you could easily use&nbsp;some other way of performing &#8220;dependency injection&#8221;. &nbsp;The initializer strategy just makes it super clear in <em>my</em> mind what the class' dependencies are, so that's what I'm going to do here. &nbsp;Have a look:</p>

<pre class="lang:swift mark:5-9 decode:true">import Foundation
import CoreData

class MyClass {
    let context: NSManagedObjectContext
    
    init(managedObjectContext: NSManagedObjectContext) {
        self.context = managedObjectContext
    }
}</pre>

<p>Now, let's say that my example class has a member function called&nbsp;<span class="lang:swift decode:true  crayon-inline">databaseHasRecordsForSomeEntity</span>&nbsp; that returns a <span class="lang:swift decode:true  crayon-inline ">Bool</span>&nbsp;&nbsp;value of <strong>true</strong> if the resulting array of a fetch request contains objects, and a <span class="lang:swift decode:true  crayon-inline ">Bool</span>&nbsp;&nbsp;value of <strong>false</strong> if the result array of a fetch request is empty. &nbsp;The completed class looks like this:</p>

<pre class="lang:swift mark:12-16 decode:true">import Foundation
import CoreData

class MyClass {
    let context: NSManagedObjectContext
    
    init(managedObjectContext: NSManagedObjectContext) {
        self.context = managedObjectContext
    }
    
    // If the array returned from executing a fetch request contains objects, return true; if empty, return false
    func databaseHasRecordsForSomeEntity() -&gt; Bool {
        let fetchRequest = NSFetchRequest(entityName: "SomeEntity")
        let fetchRequestResults = self.context.executeFetchRequest(fetchRequest, error: nil) // May want to do something with the error in real life...
        return (fetchRequestResults?.count &gt; 0)
    }
}</pre>

<p>I want to test if&nbsp;<span class="lang:swift decode:true  crayon-inline ">databaseHasRecordsForSomeEntity</span>&nbsp;&nbsp;does what I intend it to do. So&#8230;</p>

<h4 id="2-nbsp-create-an-nbsp-span-class-lang-swift-decode-true-crayon-inline-xctestcase-span-nbsp-nbsp-class-with-a-test-function-in-your-unit-test-project">2. &nbsp;Create an&nbsp;<span class="lang:swift decode:true  crayon-inline">XCTestCase</span>&nbsp;&nbsp;class with a test function in your unit test project</h4>

<p>Just listing this for completeness</p>

<p>Next comes the way to make the mock. &nbsp;Read steps 3-5 and then look below for a code example of what the skeleton will look like.</p>

<h4 id="3-nbsp-within-the-function-body-create-nbsp-a-nbsp-nested-nbsp-class">3. &nbsp;Within the function body create&nbsp;a&nbsp;<em>nested</em>&nbsp;class</h4>

<h4 id="4-nbsp-make-the-nested-class-inherit-from-the-real-object-you-8217-re-trying-to-mock-create-a-method-stub-for">4. &nbsp;Make the nested class inherit from the real object you're trying to mock / create a method stub for</h4>

<h4 id="5-nbsp-you-can-give-the-nested-class-a-name-such-as-mock-objectname">5. &nbsp;You can give the nested class a name such as Mock[ObjectName]</h4>

<pre class="lang:swift mark:3,18-22 decode:true">import UIKit
import XCTest
import CoreData // &lt;-- Make sure to import CoreData or you will get errors when you try to use NSManagedObjectContext

class MyClassTests: XCTestCase {

    override func setUp() {
        super.setUp()
        // Put setup code here. This method is called before the invocation of each test method in the class.
    }
    
    override func tearDown() {
        // Put teardown code here. This method is called after the invocation of each test method in the class.
        super.tearDown()
    }

    // Yay for verbose test names!  :]
    func testDatabaseHasRecordsForSomeEntityReturnsTrueWhenFetchRequestReturnsNonEmptyArray() {
        class MockNSManagedObjectContext: NSManagedObjectContext {
            
        }
    }
}</pre>

<h4 id="nbsp-6-nbsp-configure-the-mock-object-however-you-need-by-setting-its-properties-or-overriding-its-function-implementations-with-stubbed-implementations-8211-no-need-to-override-every-function-8230-only-the-one-s-that-your-class-calls-during-the-test-at-hand">&nbsp;6. &nbsp;Configure the mock object however you need by setting its properties or overriding its function implementations with stubbed implementations – no need to override every function&#8230; only the one(s) that your class calls during the test at hand</h4>

<p>For my example, I'm going to stub out the <span class="lang:swift decode:true  crayon-inline">executeFetchRequest</span>&nbsp;&nbsp;method so that it returns an array with one object in it. &nbsp;This is really the part where you have to determine what you're testing and what you expect the stubbed results to be. &nbsp;Whatever you decide, the way to stub a method is simply to override it in the mock you're implementing. &nbsp;Here's how I implemented the&nbsp;<span class="lang:swift decode:true  crayon-inline ">executeFetchRequest</span>&nbsp;&nbsp;stub for my example:</p>

<pre class="lang:swift mark:4-5 decode:true">// Yay for verbose test names!  :]
    func testDatabaseHasRecordsForSomeEntityReturnsTrueWhenFetchRequestReturnsNonEmptyArray() {
        class MockNSManagedObjectContext: NSManagedObjectContext {
            override func executeFetchRequest(request: NSFetchRequest, error: NSErrorPointer) -> [AnyObject]? {
                return ["object 1"]
            }
        }
    }</pre>

<p>We're ready to perform the test and assert the results. &nbsp;Read steps 7-8 and take a look at the code example below step 8:</p>

<h4 id="7-nbsp-instantiate-the-class-you-8217-re-testing-and-pass-in-an-instance-of-the-nbsp-mock-object-you-just-nested-in-the-test-function-to-your-nbsp-class-somehow-either-through-its-initializer-by-setting-a-property-on-the-class-or-by-passing-it-into-the-method-under-test-via-parameter-8212-however-you-intended-to-8216-inject-8217-the-mock-from-step-1-is-what-you-should-do">7. &nbsp;Instantiate the class you're testing and pass in an instance of the&nbsp;mock object you just nested in the test function to your&nbsp;class somehow (either through its initializer, by setting a property on the class, or by passing it into the method under test via parameter &#8212; however you intended to &#8216;inject' the mock from step 1 is what you should do)</h4>

<h4 id="8-nbsp-xctassert-8230">8. &nbsp;XCTAssert&#8230;</h4>

<p>From step 1, I intended to pass an NSManagedObjectContext instance to the initializer of MyClass, so that's what I'll do in my test. &nbsp;I'll then perform the XCTAssert on the return value of my method under test:</p>

<p>&nbsp;</p>

<pre class="lang:swift mark:9-18 decode:true">// Yay for verbose test names!  :]
    func testDatabaseHasRecordsForSomeEntityReturnsTrueWhenFetchRequestReturnsNonEmptyArray() {
        class MockNSManagedObjectContext: NSManagedObjectContext {
            override func executeFetchRequest(request: NSFetchRequest, error: NSErrorPointer) -> [AnyObject]? {
                return ["object 1"]
            }
        }
        
        // Instantiate mock
        let mockContext = MockNSManagedObjectContext()
        
        // Instantiate class under test and pass it the mockContext object
        let myClassInstance = MyClass(managedObjectContext: mockContext)
        
        // Call the method under test and store its return value for XCTAssert
        let returnValue = myClassInstance.databaseHasRecordsForSomeEntity()
        
        XCTAssertTrue(returnValue == true, "The return value should be been true")
    }</pre>

<p>Running the tests at this point should produce a passing test using the mock object in place of a real NSManagedObjectContext that calls a database!</p>

<p>Now, if I wanted to test the &#8220;false&#8221; branch of my class' method, I could simply create another test method following the same steps, only this time, I'd provide a new implementation for the overridden <span class="lang:swift decode:true  crayon-inline ">executeFetchRequest</span>&nbsp;&nbsp;method that's appropriate:</p>

<pre class="lang:default mark:4,17 decode:true">func testDatabaseHasRecordsForSomeEntityReturnsFalseWhenFetchRequestReturnsEMPTYArray() {
        class MockNSManagedObjectContext: NSManagedObjectContext {
            override func executeFetchRequest(request: NSFetchRequest, error: NSErrorPointer) -> [AnyObject]? {
                return [] // Provided a different stub implementation to test the "false" branch of my method under test
            }
        }
        
        // Instantiate mock
        let mockContext = MockNSManagedObjectContext()
        
        // Instantiate class under test
        let myClassInstance = MyClass(managedObjectContext: mockContext)
        
        // Call the method under test and store its return value for XCTAssert
        let returnValue = myClassInstance.databaseHasRecordsForSomeEntity()
        
        XCTAssertTrue(returnValue == false, "The return value should be been false")
    }</pre>

<p>And that's a wrap – happy mocking and stubbing in Swift!</p>

<p>EDIT: &nbsp;July 22, 2014 – I've added a simple XCode Project to GitHub for those interested in seeing the setup directly in XCode at &nbsp;<a title="GitHub - MocksAndStubs" href="https://github.com/andrewcbancroft/MocksAndStubs" target="_blank"><a href="https://github.com/andrewcbancroft/MocksAndStubs">https://github.com/andrewcbancroft/MocksAndStubs</a></a></p>

<div class="related-posts">
  You might also enjoy</p> 
  
  <ul>
    <li>
      <a href="http://www.andrewcbancroft.com/2014/12/10/dont-write-legacy-swift/" title="Don’t Write Legacy Swift">Don't Write Legacy Swift</a>
    </li>
    <li>
      <a href="http://www.andrewcbancroft.com/2014/07/22/swift-access-control-implications-for-unit-testing/" title="Swift Access Control – Implications for Unit Testing">Swift Access Control – Implications for Unit Testing</a>
    </li>
  </ul>
</div>


    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "andrewcbancroft" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </article>



            </div>

        </div>
    </div>

    

    <footer class="footer text-center">
        <div class="container">
            <span class="text-muted">This project contains 146 pages and is available on <a href="https://github.com/andrewcbancroft/datadaylife-blog">GitHub</a>. Copyright &copy; Andrew Bancroft, <time datetime="2019">2019</time>.</span>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
        crossorigin="anonymous"></script>

</body>

</html>